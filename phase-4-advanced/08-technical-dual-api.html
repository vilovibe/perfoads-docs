<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Reference: Dual API Architecture - PerfoAds Documentation</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #126DFB;
            --dark-text: #000000;
            --light-gray: #6B7280;
            --border-gray: #E5E7EB;
            --bg-white: #FFFFFF;
            --bg-gray: #F9FAFB;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            background: var(--bg-white);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Geist', sans-serif;
            font-weight: 700;
            letter-spacing: -0.03em;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border-gray);
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-gray);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--dark-text);
        }

        .logo img {
            width: 32px;
            height: 32px;
        }

        .logo span {
            font-family: 'Geist', sans-serif;
            font-weight: 700;
            font-size: 18px;
        }

        .nav-section {
            padding: 24px 0;
            border-bottom: 1px solid var(--border-gray);
        }

        .nav-section-title {
            padding: 0 24px 12px;
            font-family: 'Geist', sans-serif;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--light-gray);
        }

        .nav-link {
            display: block;
            padding: 8px 24px;
            color: var(--dark-text);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: var(--bg-gray);
            color: var(--primary-blue);
        }

        .nav-link.active {
            color: var(--primary-blue);
            background: var(--bg-gray);
            border-left: 3px solid var(--primary-blue);
            padding-left: 21px;
        }

        .sidebar-footer {
            padding: 24px;
            margin-top: auto;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-blue);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 48px 64px;
            max-width: 1200px;
        }

        .hero {
            margin-bottom: 48px;
        }

        .hero h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .hero p {
            font-size: 20px;
            color: var(--light-gray);
        }

        .doc-section {
            margin-bottom: 48px;
        }

        .doc-section h2 {
            font-size: 28px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .doc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .doc-card {
            padding: 20px;
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark-text);
            transition: all 0.2s;
        }

        .doc-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 12px rgba(18, 109, 251, 0.1);
        }

        .doc-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .doc-card p {
            font-size: 14px;
            color: var(--light-gray);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 24px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .doc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="https://www.perfoads.com" class="logo">
                <img src="/logo.png" alt="PerfoAds">
                <span>PerfoAds</span>
            </a>
        </div>

        <nav>
            <div class="nav-section">
                <div class="nav-section-title">Getting Started</div>
                <a href="/phase-1-essential/01-what-is-perfoads.html" class="nav-link">What is PerfoAds?</a>
                <a href="/phase-1-essential/02-quick-start-guide.html" class="nav-link">Quick Start Guide</a>
                <a href="/phase-1-essential/03-adding-first-client.html" class="nav-link">Adding Your First Client</a>
                <a href="/phase-1-essential/04-understanding-dashboard.html" class="nav-link">Understanding the Dashboard</a>
                <a href="/phase-1-essential/05-smart-sync-explained.html" class="nav-link">Smart Sync Explained</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Core Features</div>
                <a href="/phase-2-core-features/01-client-list-overview.html" class="nav-link">Client List Overview</a>
                <a href="/phase-2-core-features/02-client-details-page.html" class="nav-link">Client Details Page</a>
                <a href="/phase-2-core-features/03-bulk-operations.html" class="nav-link">Bulk Operations</a>
                <a href="/phase-2-core-features/04-sync-system-guide.html" class="nav-link">Sync System Guide</a>
                <a href="/phase-2-core-features/05-auto-sync-setup.html" class="nav-link">Auto-Sync Setup</a>
                <a href="/phase-2-core-features/06-sync-logs.html" class="nav-link">Sync Logs</a>
                <a href="/phase-2-core-features/07-metrics-glossary.html" class="nav-link">Metrics Glossary</a>
                <a href="/phase-2-core-features/08-performance-charts.html" class="nav-link">Performance Charts Guide</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">AI Features</div>
                <a href="/phase-3-ai-features/01-smart-alerts-intro.html" class="nav-link">Smart Alerts Introduction</a>
                <a href="/phase-3-ai-features/02-alert-severity-guide.html" class="nav-link">Alert Severity Guide</a>
                <a href="/phase-3-ai-features/03-alert-categories.html" class="nav-link">Alert Categories Guide</a>
                <a href="/phase-3-ai-features/04-accept-decline-workflow.html" class="nav-link">Accept/Decline Workflow</a>
                <a href="/phase-3-ai-features/05-ai-chat-getting-started.html" class="nav-link">AI Chat - Getting Started</a>
                <a href="/phase-3-ai-features/06-ai-chat-templates.html" class="nav-link">AI Chat Templates</a>
                <a href="/phase-3-ai-features/07-ai-context-explained.html" class="nav-link">AI Context Explained</a>
                <a href="/phase-3-ai-features/08-business-profile-setup.html" class="nav-link">Business Profile Setup</a>
                <a href="/phase-3-ai-features/09-custom-context-entries.html" class="nav-link">Custom Context Entries</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Advanced</div>
                <a href="/phase-4-advanced/01-global-settings.html" class="nav-link">Global Settings</a>
                <a href="/phase-4-advanced/02-per-client-settings.html" class="nav-link">Per-Client Settings</a>
                <a href="/phase-4-advanced/03-column-customization.html" class="nav-link">Column Customization</a>
                <a href="/phase-4-advanced/04-export-reports.html" class="nav-link">Export Reports</a>
                <a href="/phase-4-advanced/05-troubleshooting-sync.html" class="nav-link">Troubleshooting: Sync Issues</a>
                <a href="/phase-4-advanced/06-troubleshooting-oauth.html" class="nav-link">Troubleshooting: OAuth Issues</a>
                <a href="/phase-4-advanced/07-troubleshooting-general.html" class="nav-link">Troubleshooting: General</a>
                <a href="/phase-4-advanced/08-technical-dual-api.html" class="nav-link">Technical: Dual API Architecture</a>
                <a href="/phase-4-advanced/09-technical-architecture.html" class="nav-link">Technical: System Architecture</a>
                <a href="/phase-4-advanced/10-technical-security.html" class="nav-link">Technical: Security</a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <a href="https://www.perfoads.com" class="back-link">
                ← Back to PerfoAds
            </a>
        </div>
    </aside>
    <main class="main-content">
        <div class="content"><h1>Technical Reference: Dual API Architecture</h1>
<p><strong>Audience</strong>: Developers, technical users, integrators</p>
<p>PerfoAds uses two different Google Ads API implementations to handle direct-access accounts and MCC-managed accounts. This creates a dual API architecture where response formats differ (camelCase vs snake_case). This technical guide explains the architecture, why it exists, and how the system handles both formats.</p>
<hr>
<h2>What You&#39;ll Learn</h2>
<ul>
<li>The two API implementations</li>
<li>Why dual architecture exists</li>
<li>camelCase vs snake_case field naming</li>
<li>How sync handles both formats</li>
<li>Code patterns for dual format handling</li>
<li>API client selection logic</li>
<li>Troubleshooting dual API issues</li>
<li>Migration considerations</li>
</ul>
<p><strong>Time needed</strong>: 15 minutes to read</p>
<p><strong>Prerequisite Knowledge</strong>: Basic understanding of APIs, JSON, and field naming conventions</p>
<hr>
<h2>The Two API Implementations</h2>
<h3>Implementation 1: Direct Access (Opteo/google-ads-api)</h3>
<p><strong>Library</strong>: <code>google-ads-api</code> npm package from Opteo organization</p>
<p><strong>GitHub</strong>: <a href="https://github.com/Opteo/google-ads-api">https://github.com/Opteo/google-ads-api</a></p>
<p><strong>Authentication</strong>: Direct OAuth to individual Google Ads accounts</p>
<p><strong>Response Format</strong>: <strong>camelCase</strong> field names</p>
<p><strong>Example Response</strong>:</p>
<pre><code class="language-javascript">{
  campaign: {
    id: &quot;123456789&quot;,
    name: &quot;Brand Campaign&quot;,
    status: &quot;ENABLED&quot;
  },
  adGroup: {
    id: &quot;987654321&quot;,
    name: &quot;Brand Keywords&quot;
  },
  metrics: {
    clicks: &quot;150&quot;,
    impressions: &quot;5000&quot;,
    costMicros: &quot;50000000&quot;
  }
}
</code></pre>
<p><strong>Used For</strong>: Accounts with direct OAuth access (user directly grants access)</p>
<p><strong>Example Clients</strong>: Individual advertisers, small agencies with direct account access</p>
<hr>
<h3>Implementation 2: MCC-Managed (Custom GoogleAdsDirectAPI)</h3>
<p><strong>Library</strong>: Custom <code>GoogleAdsDirectAPI</code> class (internal, makes direct HTTP calls)</p>
<p><strong>Location</strong>: <code>src/services/GoogleAdsDirectAPI.ts</code></p>
<p><strong>Authentication</strong>: Requires <code>login-customer-id</code> header for MCC authentication</p>
<p><strong>Response Format</strong>: <strong>snake_case</strong> field names</p>
<p><strong>Example Response</strong>:</p>
<pre><code class="language-javascript">{
  campaign: {
    id: &quot;123456789&quot;,
    name: &quot;Brand Campaign&quot;,
    status: &quot;ENABLED&quot;
  },
  ad_group: {
    id: &quot;987654321&quot;,
    name: &quot;Brand Keywords&quot;
  },
  metrics: {
    clicks: &quot;150&quot;,
    impressions: &quot;5000&quot;,
    cost_micros: &quot;50000000&quot;
  }
}
</code></pre>
<p><strong>Used For</strong>: Accounts managed through Manager Customer Center (MCC)</p>
<p><strong>Example Clients</strong>: Enterprise accounts, agency clients managed under MCC account</p>
<hr>
<h2>Why Dual Architecture Exists</h2>
<h3>Problem Statement</h3>
<p><strong>Google Ads API Field Naming</strong>:</p>
<ul>
<li>Official Google Ads API: Returns <strong>snake_case</strong> fields</li>
<li>Opteo library: Transforms to <strong>camelCase</strong> for JavaScript conventions</li>
</ul>
<p><strong>Account Access Patterns</strong>:</p>
<ul>
<li>Some accounts: Direct OAuth access (use Opteo library)</li>
<li>Other accounts: MCC-managed (require login-customer-id, use direct API)</li>
</ul>
<p><strong>Architecture Decision</strong>: Support both to handle all account types without forcing users to restructure their Google Ads organization</p>
<hr>
<h3>Use Cases</h3>
<p><strong>Direct Access Scenario</strong>:</p>
<pre><code>User: Small business owner
Google Ads: Single account, direct access
OAuth: Grants access directly to their account
API: Opteo library → camelCase responses
</code></pre>
<p><strong>MCC-Managed Scenario</strong>:</p>
<pre><code>User: Digital agency
Google Ads: MCC with 50 managed client accounts
OAuth: Grants access to MCC
API: Custom class with login-customer-id → snake_case responses
</code></pre>
<hr>
<h2>Field Naming Differences</h2>
<h3>Common Fields: camelCase vs snake_case</h3>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>camelCase (Direct)</th>
<th>snake_case (MCC)</th>
</tr>
</thead>
<tbody><tr>
<td>Campaign</td>
<td><code>campaign</code></td>
<td><code>campaign</code></td>
</tr>
<tr>
<td>Ad Group</td>
<td><code>adGroup</code></td>
<td><code>ad_group</code></td>
</tr>
<tr>
<td>Ad Group Ad</td>
<td><code>adGroupAd</code></td>
<td><code>ad_group_ad</code></td>
</tr>
<tr>
<td>Responsive Search Ad</td>
<td><code>responsiveSearchAd</code></td>
<td><code>responsive_search_ad</code></td>
</tr>
<tr>
<td>Metrics</td>
<td><code>metrics</code></td>
<td><code>metrics</code></td>
</tr>
<tr>
<td>Cost Micros</td>
<td><code>metrics.costMicros</code></td>
<td><code>metrics.cost_micros</code></td>
</tr>
<tr>
<td>Click Type</td>
<td><code>clickType</code></td>
<td><code>click_type</code></td>
</tr>
<tr>
<td>Conversion Action</td>
<td><code>conversionAction</code></td>
<td><code>conversion_action</code></td>
</tr>
</tbody></table>
<hr>
<h3>Real-World Example</h3>
<p><strong>Same Data, Different Format</strong>:</p>
<p><strong>Direct API (camelCase)</strong>:</p>
<pre><code class="language-javascript">{
  adGroup: {
    id: &quot;12345&quot;,
    name: &quot;Brand Keywords&quot;,
    status: &quot;ENABLED&quot;
  },
  adGroupAd: {
    id: &quot;67890&quot;,
    status: &quot;ENABLED&quot;
  },
  responsiveSearchAd: {
    headlines: [
      { text: &quot;Best Product Ever&quot; },
      { text: &quot;Shop Now&quot; }
    ],
    descriptions: [
      { text: &quot;Free shipping on all orders&quot; }
    ]
  }
}
</code></pre>
<p><strong>MCC API (snake_case)</strong>:</p>
<pre><code class="language-javascript">{
  ad_group: {
    id: &quot;12345&quot;,
    name: &quot;Brand Keywords&quot;,
    status: &quot;ENABLED&quot;
  },
  ad_group_ad: {
    id: &quot;67890&quot;,
    status: &quot;ENABLED&quot;
  },
  responsive_search_ad: {
    headlines: [
      { text: &quot;Best Product Ever&quot; },
      { text: &quot;Shop Now&quot; }
    ],
    descriptions: [
      { text: &quot;Free shipping on all orders&quot; }
    ]
  }
}
</code></pre>
<p><strong>Identical Data</strong>: Only field names differ</p>
<hr>
<h2>How Sync Handles Both Formats</h2>
<h3>Defensive Field Access Pattern</h3>
<p><strong>The Problem</strong>: Can&#39;t assume which format response will be in</p>
<p><strong>The Solution</strong>: Check both formats, use whichever exists</p>
<p><strong>Code Pattern</strong>:</p>
<pre><code class="language-javascript">// ❌ WRONG - Breaks for one or the other
const adGroupId = row.adGroup.id;  // Breaks for MCC
const adGroupId = row.ad_group.id; // Breaks for Direct

// ✅ CORRECT - Works for both
const adGroup = row.adGroup || row.ad_group;
const adGroupId = adGroup?.id;
</code></pre>
<hr>
<h3>Real Code Examples</h3>
<p><strong>Example 1: Accessing Ad Group</strong>:</p>
<pre><code class="language-javascript">// Sync code handling both formats
const processAdGroup = (row) =&gt; {
  // Try camelCase first, fall back to snake_case
  const adGroup = row.adGroup || row.ad_group;

  if (!adGroup) {
    console.error(&#39;No ad group found in response&#39;);
    return null;
  }

  return {
    id: adGroup.id,
    name: adGroup.name,
    status: adGroup.status
  };
};
</code></pre>
<p><strong>Example 2: Accessing Nested Fields</strong>:</p>
<pre><code class="language-javascript">// Accessing responsive search ad headlines
const getHeadlines = (ad) =&gt; {
  // Check both possible locations
  const rsa = ad?.responsiveSearchAd || ad?.responsive_search_ad;

  if (!rsa || !rsa.headlines) {
    return [];
  }

  return rsa.headlines.map(h =&gt; h.text);
};
</code></pre>
<p><strong>Example 3: Metrics</strong>:</p>
<pre><code class="language-javascript">// Accessing cost (micros to dollars conversion)
const getCost = (metrics) =&gt; {
  // Try both field names
  const costMicros = metrics?.costMicros || metrics?.cost_micros;

  if (!costMicros) return 0;

  // Convert micros to dollars
  return parseInt(costMicros) / 1000000;
};
</code></pre>
<hr>
<h2>API Client Selection Logic</h2>
<h3>How System Chooses Which API to Use</h3>
<p><strong>Decision Tree</strong>:</p>
<pre><code>Client Added
  ↓
Does client have login_customer_id configured?
  ↓
  YES → Use MCC API (Custom GoogleAdsDirectAPI)
    ↓
    Response: snake_case fields

  NO → Use Direct API (Opteo google-ads-api)
    ↓
    Response: camelCase fields
</code></pre>
<hr>
<h3>Configuration</h3>
<p><strong>Client Model</strong> (database):</p>
<pre><code class="language-javascript">{
  id: 123,
  customer_id: &quot;123-456-7890&quot;,
  login_customer_id: &quot;999-888-7777&quot; // If set: MCC mode
}
</code></pre>
<p><strong>Sync Logic</strong>:</p>
<pre><code class="language-javascript">const getApiClient = (client) =&gt; {
  if (client.login_customer_id) {
    // MCC-managed account
    return new GoogleAdsDirectAPI({
      customer_id: client.customer_id,
      login_customer_id: client.login_customer_id
    });
  } else {
    // Direct access account
    return new GoogleAdsAPI({
      customer_id: client.customer_id
    });
  }
};
</code></pre>
<hr>
<h2>Handling Both Formats in Code</h2>
<h3>Pattern 1: Dual Field Check</h3>
<p><strong>Use When</strong>: Accessing top-level fields</p>
<pre><code class="language-javascript">// Access campaign
const campaign = row.campaign || row.campaign; // Same name, no issue
const adGroup = row.adGroup || row.ad_group;   // Different names
const adGroupAd = row.adGroupAd || row.ad_group_ad;
</code></pre>
<hr>
<h3>Pattern 2: Nested Field Check</h3>
<p><strong>Use When</strong>: Accessing deeply nested fields</p>
<pre><code class="language-javascript">// Access ad type-specific data
const rsa = ad?.responsiveSearchAd || ad?.responsive_search_ad;
const headlines = rsa?.headlines || [];

// Access metrics
const metrics = row.metrics || {};
const clicks = metrics.clicks;  // Same name both formats
const cost = metrics.costMicros || metrics.cost_micros;
</code></pre>
<hr>
<h3>Pattern 3: Normalization Helper</h3>
<p><strong>Use When</strong>: Processing many records</p>
<pre><code class="language-javascript">// Normalize response to consistent format
const normalizeAdGroup = (row) =&gt; {
  const source = row.adGroup || row.ad_group;

  return {
    id: source.id,
    name: source.name,
    status: source.status,
    campaign_id: (row.campaign || row.campaign).id
  };
};

// Now work with normalized data
const adGroups = rawData.map(normalizeAdGroup);
</code></pre>
<hr>
<h2>Troubleshooting Dual API Issues</h2>
<h3>Problem: Field Not Found Error</h3>
<p><strong>Symptom</strong>:</p>
<pre><code>TypeError: Cannot read property &#39;id&#39; of undefined
Error accessing: row.adGroup.id
</code></pre>
<p><strong>Diagnosis</strong>: Code assumes one format, data is in other format</p>
<p><strong>Fix</strong>:</p>
<pre><code class="language-javascript">// Change from:
const id = row.adGroup.id;

// To:
const adGroup = row.adGroup || row.ad_group;
const id = adGroup?.id;
</code></pre>
<hr>
<h3>Problem: Data Syncs for Some Clients, Fails for Others</h3>
<p><strong>Symptom</strong>:</p>
<pre><code>Client A (direct access): Sync works
Client B (MCC-managed): Sync fails with field access errors
</code></pre>
<p><strong>Diagnosis</strong>: Code not handling both formats</p>
<p><strong>Fix</strong>: Review sync code, add dual format handling to all field accesses</p>
<hr>
<h3>Problem: Metrics Missing for MCC Accounts</h3>
<p><strong>Symptom</strong>:</p>
<pre><code>Direct accounts: All metrics present
MCC accounts: metrics.costMicros undefined
</code></pre>
<p><strong>Diagnosis</strong>: Using camelCase field name for MCC response</p>
<p><strong>Fix</strong>:</p>
<pre><code class="language-javascript">// Change from:
const cost = metrics.costMicros;

// To:
const cost = metrics.costMicros || metrics.cost_micros;
</code></pre>
<hr>
<h2>Best Practices</h2>
<h3>1. Always Use Dual Field Check</h3>
<p><strong>Rule</strong>: Never access <code>row.adGroup</code> directly. Always check both.</p>
<p><strong>Pattern</strong>:</p>
<pre><code class="language-javascript">// ✅ GOOD
const adGroup = row.adGroup || row.ad_group;
if (adGroup) {
  // Use adGroup
}

// ❌ BAD
if (row.adGroup) {  // Breaks for MCC
  // Use row.adGroup
}
</code></pre>
<hr>
<h3>2. Use Optional Chaining</h3>
<p><strong>Leverage <code>?.</code> operator</strong>:</p>
<pre><code class="language-javascript">// ✅ SAFE
const headlines = ad?.responsiveSearchAd?.headlines ||
                  ad?.responsive_search_ad?.headlines ||
                  [];

// ❌ RISKY
const headlines = ad.responsiveSearchAd.headlines; // Crashes if null
</code></pre>
<hr>
<h3>3. Normalize Early</h3>
<p><strong>Pattern</strong>: Convert to consistent format as soon as data arrives</p>
<pre><code class="language-javascript">// In sync layer
const normalizeResponse = (row) =&gt; {
  return {
    campaign: {
      id: row.campaign?.id,
      name: row.campaign?.name
    },
    adGroup: {
      id: (row.adGroup || row.ad_group)?.id,
      name: (row.adGroup || row.ad_group)?.name
    },
    metrics: {
      clicks: row.metrics?.clicks,
      cost: row.metrics?.costMicros || row.metrics?.cost_micros
    }
  };
};
</code></pre>
<p><strong>Benefit</strong>: Rest of codebase works with consistent format</p>
<hr>
<h2>Testing Both Formats</h2>
<h3>Unit Test Pattern</h3>
<pre><code class="language-javascript">describe(&#39;Sync Dual API Handling&#39;, () =&gt; {
  it(&#39;should handle camelCase (Direct API) format&#39;, () =&gt; {
    const row = {
      campaign: { id: &quot;123&quot;, name: &quot;Test&quot; },
      adGroup: { id: &quot;456&quot;, name: &quot;Test Group&quot; },
      metrics: { clicks: &quot;100&quot;, costMicros: &quot;5000000&quot; }
    };

    const result = processSyncRow(row);
    expect(result.adGroupId).toBe(&quot;456&quot;);
    expect(result.cost).toBe(5.00);
  });

  it(&#39;should handle snake_case (MCC API) format&#39;, () =&gt; {
    const row = {
      campaign: { id: &quot;123&quot;, name: &quot;Test&quot; },
      ad_group: { id: &quot;456&quot;, name: &quot;Test Group&quot; },
      metrics: { clicks: &quot;100&quot;, cost_micros: &quot;5000000&quot; }
    };

    const result = processSyncRow(row);
    expect(result.adGroupId).toBe(&quot;456&quot;);
    expect(result.cost).toBe(5.00);
  });
});
</code></pre>
<hr>
<h2>Migration and Future Considerations</h2>
<h3>Potential Future Normalization</h3>
<p><strong>Option</strong>: Normalize all responses to single format (camelCase) at API layer</p>
<p><strong>Benefit</strong>: Rest of codebase simpler, no dual checks</p>
<p><strong>Cost</strong>: Additional processing layer, potential performance impact</p>
<p><strong>Decision</strong>: Not implemented yet. Current dual-check approach works reliably.</p>
<hr>
<h3>If Google Ads API Changes</h3>
<p><strong>Scenario</strong>: Google updates API, changes field naming</p>
<p><strong>Impact</strong>: Would affect custom MCC implementation, not Opteo library</p>
<p><strong>Mitigation</strong>: Version lock on Google Ads API, test before upgrading</p>
<hr>
<h2>Common Questions</h2>
<p><strong>Q: Can I convert all MCC accounts to direct access to avoid this?</strong>
A: Not always. MCC structure often required for agency setups, billing, and permissions.</p>
<p><strong>Q: Does dual API affect performance?</strong>
A: Minimal. Dual field check is fast. Main performance factor is network latency to Google Ads API.</p>
<p><strong>Q: Will this architecture change in future?</strong>
A: Possibly normalize at sync layer for simpler downstream code. But dual format support will remain.</p>
<p><strong>Q: How do I know which API a client uses?</strong>
A: Check <code>login_customer_id</code> field. If set: MCC API. If null: Direct API.</p>
<p><strong>Q: Can I force a client to use one API or the other?</strong>
A: Set or unset <code>login_customer_id</code> in client configuration. But must match actual Google Ads account setup.</p>
<hr>
<h2>Technical Deep Dive: MCC Authentication</h2>
<h3>How MCC Authentication Differs</h3>
<p><strong>Direct Access</strong>:</p>
<pre><code>Request Headers:
- Authorization: Bearer [oauth-token]
- developer-token: [google-ads-dev-token]

Request:
GET /v21/customers/123-456-7890/campaigns
</code></pre>
<p><strong>MCC Access</strong>:</p>
<pre><code>Request Headers:
- Authorization: Bearer [oauth-token]
- developer-token: [google-ads-dev-token]
- login-customer-id: 999-888-7777  ← MCC ID

Request:
GET /v21/customers/123-456-7890/campaigns
</code></pre>
<p><strong>Key Difference</strong>: <code>login-customer-id</code> header authenticates as MCC, then accesses managed account</p>
<hr>
<h2>Next Steps</h2>
<p>Understand the technical architecture with these guides:</p>
<ul>
<li><strong><a href="/docs/technical-architecture">Technical Architecture</a></strong> - Complete system architecture overview</li>
<li><strong><a href="/docs/technical-security">Technical Security</a></strong> - Security implementation details</li>
<li><strong><a href="/docs/troubleshooting-sync">Troubleshooting Sync</a></strong> - Debug sync issues related to API formats</li>
<li><strong><a href="/docs/smart-sync-explained">Smart Sync Explained</a></strong> - How sync uses both APIs</li>
</ul>
<hr>
<p><strong>Always use dual field checks</strong> when accessing API responses</p>
<p><strong>Test with both formats</strong> to ensure compatibility</p>
<p><strong>Normalize early</strong> to simplify downstream processing</p>
<p><strong>Last Updated</strong>: October 4, 2025</p>
</div>
    </main>
</body>
</html>